
# Table of Contents

1.  [Abstract](#org8f7068b)
2.  [Some kind of license?](#org549cc7c)
3.  [Preamble](#orga2d1de8)
4.  [Use](#orgba8cbfd)
5.  [Code](#org23becf0)
    1.  [prehelp](#org256ac11)
        1.  [if](#orgac9491f)
        2.  [fi](#org1933af0)
    2.  [help](#org762951e)
        1.  [if](#org916d52a)
        2.  [show help](#orgc3fa0e6)
        3.  [show options](#org0a1b948)
        4.  [warning](#orgeb36a8e)
        5.  [fi](#org499a2d6)
    3.  [identify file to be manipulated](#org2dca3ef)
        1.  [if](#org5dcd64b)
        2.  [store file info](#org352976b)
        3.  [fi](#org4f615a9)
    4.  [overwrite](#orgddf55af)
        1.  [if](#org142b735)
        2.  [heads up](#org02b0b5d)
        3.  [backup file and start `tmuxp freeze` process](#orgd9c707b)
        4.  [done check](#orgf721835)
        5.  [fi](#org096e9c6)
    5.  [recover](#orgbb26279)
        1.  [if](#org9ac44ca)
        2.  [mv file~ to file](#org7339316)
        3.  [fi](#orge442c33)
    6.  [depython](#org80b0d2a)
        1.  [if](#org7693e3c)
        2.  [heads up](#orgdff1a43)
        3.  [the actual thing](#org2622cf0)
        4.  [done check](#org6ae7f07)
        5.  [fi](#orgfbd3211)
    7.  [debash](#org2a5cab6)
        1.  [case](#org4045afd)
        2.  [code](#orge60f0f8)
    8.  [exit](#orgefd3cfa)
6.  [Installation](#orga8cce62)



<a id="org8f7068b"></a>

# Abstract

Tmuxp doesn't currently allow you to overwrite existing tmuxp files
generated by typing `tmuxp freeze`. This bash script emulates that
behavior.


<a id="org549cc7c"></a>

# Some kind of license?

Do with this code what you deem appropriate, just remember to use at
your own risk. I'd recommend you to check it first since it's not that
complicated anyway, just a bunch of conveniently placed bash
commands. Happy coding.


<a id="orga2d1de8"></a>

# Preamble

Be aware: this is just a momentary solution until tmuxp adopts session
overwriting natively. And my bash scripting capabilities are quite
humble, still I want to be able to programmatically overwrite a `tmuxp
freeze` file.

Here you can see that the issue has not been addressed in a while (at
least at the time of this writing):
<https://github.com/tmux-python/tmuxp/issues/64>

Also, `tmuxp freeze` at the moment of `freezing` a session adds the
next line to the generated file:

    shell_command: python3

This line makes `tmuxp load yourFrozenSession` to automatically start
a `python3` process every time you load your session. At least for me,
this behavior is unwanted. This code removes that line from the
generated file too.

I opened (and quickly closed) an issue about this which you can read
about here:

<https://github.com/tmux-python/tmuxp/issues/588>


<a id="orgba8cbfd"></a>

# Use

Warning: there are a couple of things you have to make sure before you
execute this command.

-   You have to be <span class="underline">attached</span> to the tmux session you want to `tmuxp
      freeze`.

-   Your tmux session must be the only active session in the tmux
    server. This is a thing with tmuxp itself which I'm not gonna
    investigate further. I just know that's how it can work without any
    problems.


<a id="org23becf0"></a>

# Code


<a id="org256ac11"></a>

## prehelp


<a id="orgac9491f"></a>

### if

    if [[ -z "$1"  ]]
    then

    echo 'tpoverwrite is a bash macro to overwrite tmuxp sessions'
    echo 'type '\''tpoverwrite --help'\'' for more info'
    exit


<a id="org1933af0"></a>

### fi

    fi


<a id="org762951e"></a>

## help


<a id="org916d52a"></a>

### if

    if [[ $1 == '--help' ]]
    then


<a id="orgc3fa0e6"></a>

### show help

    echo 'tpoverwrite - tmuxp overwrite'
    echo ''
    echo 'tpoverwrite is a bash macro that lets you quickly overwrite an'
    echo 'EXISTING tmuxp session (it won'\''t create a new one from scratch).'
    echo ''
    echo 'source code: '
    echo 'USAGE'
    echo ''\''tpoverwrite OPTION'\'''
    echo ''


<a id="org0a1b948"></a>

### show options

    echo 'OPTIONS'
    echo '-o'
    echo '--overwrite'
    echo 'overwrite your EXISTING tmuxp frozen file'
    echo ''
    echo '--depython'
    echo 'remove that '\''python3'\'' line from the frozen file'
    echo '--debash'
    echo 'remove that '\''bash'\'' line from the frozen file'
    echo 'remove that '\''shell_command: bash'\'' line from the frozen file'


<a id="orgeb36a8e"></a>

### warning

    echo 'for the moment it only works with .yaml files since I don'\''t know yet'
    echo 'how to implement TAB completion from within a bash script :D'
    echo 'Happy coding'
    exit


<a id="org499a2d6"></a>

### fi

    fi


<a id="org2dca3ef"></a>

## identify file to be manipulated

If you give it not `--help` option then you want to actually use it.

By the way, `tmuxp` is more flexible in the search of the file, this
script for the moment is not that flexible; it looks only in
~/.tmuxp/. If I need it to be more flexible in the future I will
update it, but that's not guaranteed since for the moment it's just
what I need.


<a id="org5dcd64b"></a>

### if

    if [[ "$1" != "--help" ]] || [[ -z $1 ]]
    then


<a id="org352976b"></a>

### store file info

    FILE_LOCATION=~/.tmuxp
    SESSION_NAME=$(tmux display-message -p '#S')
    EXTENSION=yaml
    YOUR_FILE=$FILE_LOCATION/$SESSION_NAME.$EXTENSION


<a id="org4f615a9"></a>

### fi

    fi


<a id="orgddf55af"></a>

## overwrite

backup and remove existing frozen file

Get tmux session name from bash:
<https://superuser.com/questions/410017/how-do-i-know-current-tmux-session-name-by-running-tmux-command>


<a id="org142b735"></a>

### if

    if [[ "$1" == "-o" ]] || [[ "$1" == "--overwrite" ]]
    then


<a id="org02b0b5d"></a>

### heads up

There's a catch I don't know how to solve:

If for any reason you abort the `freeze` process, you'll end up with
no `freeze` file, which will cause errors the next time you'll want to overwrite.

Gotta check that.

If you abort the freezing, you can recover.

    echo "Overwriting your tmuxp session:"


<a id="orgd9c707b"></a>

### backup file and start `tmuxp freeze` process

    cat $YOUR_FILE > $YOUR_FILE~ # for backup
    rm $YOUR_FILE
    tmuxp freeze 


<a id="orgf721835"></a>

### done check

    echo 'tmuxp session backed up and overwriten in:'
    echo $YOUR_FILE


<a id="org096e9c6"></a>

### fi

    fi


<a id="orgbb26279"></a>

## recover


<a id="org9ac44ca"></a>

### if

    if [[ "$1" == "-r" ]] || [[ "$1" == "--recover" ]]
    then


<a id="org7339316"></a>

### mv file~ to file

    if mv "$YOUR_FILE~" "$YOUR_FILE"
    then
    echo 'renamed:'
    echo \'$YOUR_FILE~\'
    echo 'to'
    echo \'$YOUR_FILE\'
    fi


<a id="orge442c33"></a>

### fi

    fi


<a id="org80b0d2a"></a>

## depython

remove `python3` line from generated `tmuxp freeze` file.
Once the file is generated, it should contain a line that says

    ~shell_command: python3~

, the next code gets rid of that line.


<a id="org7693e3c"></a>

### if

    if [[ "$1" == "--depython" ]]
    then


<a id="orgdff1a43"></a>

### heads up

    echo 'Warning: if you actually are running anything that contains the word'
    echo 'python3 and gets saved into the session, it could mess with your'
    echo 'tmuxp freeze file.'
    echo ''
    echo 'A backup of your file will be stored in'
    echo '/tmp/tmuxp/frozenPreCleaning/'
    echo 'in case anything goes wrong.'


<a id="org2622cf0"></a>

### the actual thing

    AUX_FILE=$FILE_LOCATION/auxFile
    cat $YOUR_FILE > ~/.tmuxp/depython/$SESSION_NAME.$EXTENSION
    sed '/python3/d' $YOUR_FILE > $AUX_FILE
    cat $AUX_FILE > $YOUR_FILE


<a id="org6ae7f07"></a>

### done check

    echo 'done: file depythoned.'


<a id="orgfbd3211"></a>

### fi

    fi


<a id="org2a5cab6"></a>

## debash


<a id="org4045afd"></a>

### case

When you `freeze` a session that has at least one window with the bare
command line in it, `tmuxp freeze` actually remembers that too and,
much like the python3 thing, also does it with `bash`. That is less of
a problem that the `python3` case, but still when you `tmuxp load`
you'll end up with unnecessary shell nesting. Try it out yourself:
type 

    echo $SHLVL

and see the output.

-   When you open a terminal it's 1
-   When you open tmux inside a terminal it's 2
-   When you `tmuxp load` it's 3. However when I created that session to
    be frozen it was 2. One shell nesting level extra.

The next script do the exact same thing that the `python3` case but
now for the `bash` command being written in the frozen file.


<a id="orge60f0f8"></a>

### code

1.  if

        if [[ "$1" == "--debash" ]]
        then

2.  heads up

        echo 'Warning: if you actually are running anything that contains the word'
        echo ''\''bash'\'' and gets saved into the session, it could mess with your'
        echo 'tmuxp freeze file.'
        echo ''
        echo 'A backup of your file will be stored in'
        echo '/tmp/tmuxp/frozenPreCleaning/'
        echo 'in case anything goes wrong.'

3.  the actual thing

        AUX_FILE=$FILE_LOCATION/auxFile
        cat $YOUR_FILE > ~/.tmuxp/depython/$SESSION_NAME.$EXTENSION
        sed '/shell_command:\ bash/d' $YOUR_FILE > $AUX_FILE
        cat $AUX_FILE > $YOUR_FILE

4.  done check

        echo 'done: file debashed.'

5.  fi

        fi


<a id="orgefd3cfa"></a>

## exit

    exit


<a id="orga8cce62"></a>

# Installation

It's just a bash script, you can `git clone` this repo, move it into
your `~/bin/` and start using it (remember to load your `bin` folder in
your $PATH).

    git clone git@github.com:Ma-Nu-El/tmuxpoverwrite.git 

